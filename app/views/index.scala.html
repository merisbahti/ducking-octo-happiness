@()
@head("Title")
  <div class="container">
    <form enctype="multipart/form-data" action="./upload" method="POST">
      <input type="file" name="picture">
      <input type="submit">
    </form>
    <form enctype="multipart/form-data">
        <input name="file" type="file" />
        <input type="button" value="Upload" />
    </form>
    <div id="files">
    </div>
  </div>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script>



function progressHandler(e){
    if(e.lengthComputable){
        console.log('done: ' + e.loaded + ' of ' + e.total);
        $('progress').attr({value:e.loaded,max:e.total});
    }
}

$(':file').change(function(){
    var file = this.files[0];
    var name = file.name;
    var size = file.size;
    var type = file.type;
    $('.files').append('<div id="test">' + file.name + '<progress id="fileProgress"/></div>');
});

$(':button').click(function(){
    var formData = new FormData($('form')[0]);
    $.ajax({
        url: './upload',  //Server script to process data
        type: 'POST',
        xhr: function() {  // Custom XMLHttpRequest
            var myXhr = $.ajaxSettings.xhr();
            if(myXhr.upload){ // Check if upload property exists
                myXhr.upload.addEventListener('progress',progressHandler, false); 
            }
            return myXhr;
        },
         //Ajax events
        beforeSend: function(jqXHR, settings) {
          console.log("beforesend.");
        },
        success: function(data, textStatus, jqHXR) {
          console.log("success!");
          console.log('data: '+data);
          console.log('status: ' + textStatus);
        },
        error: function (jqXHR, textStatus, errorThrown) {
          console.log("status:" + textStatus);
          console.log("error:" + errorThrown);
        },
        // Form data
        data: formData,
        //Options to tell jQuery not to process data or worry about content-type.
        cache: false,
        contentType: false,
        processData: false
    });
});
</script>

@foot()
